{% extends 'layouts/account_layout.html' %}
{% load static %}

{% block title %}
{% if user.first_name and user.last_name %}{{ user.first_name }} {{ user.last_name }}{% else %}{{ user.username }}{% endif %} | Biomedia
{% endblock title %}


{% block account_layout %}
<h2 class="text-xl font-medium mb-4">Аккаунт</h2>

<form method="post" enctype="multipart/form-data" class="space-y-4 max-w-lg">
    {% csrf_token %}

    <!-- Avatar field -->
    <div class="relative w-24 h-24 mx-auto lg:mx-0">
        <label for="avatar-input" class="cursor-pointer group block w-24 h-24 rounded-full overflow-hidden relative">
            {% if user.avatar %}
                <img 
                    id="avatar-preview" 
                    src="{{ user.avatar.url }}" 
                    alt="Avatar" 
                    class="w-full h-full object-cover transition-opacity duration-300 group-hover:opacity-70"
                >
            {% else %}
                <div 
                    id="avatar-preview"
                    class="w-full h-full bg-neutral-100 flex items-center justify-center text-neutral-950 text-4xl"
                >
                    {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                </div>
            {% endif %}

            <div class="absolute inset-0 bg-black/70 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-image-icon lucide-image">
                    <rect width="18" height="18" x="3" y="3" rx="2" ry="2" />
                    <circle cx="9" cy="9" r="2" />
                    <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" />
                </svg>
            </div>
        </label>

        <input type="file" name="avatar" id="avatar-input" accept="image/*" class="hidden">

        <script>
            const input = document.getElementById('avatar-input');
            const preview = document.getElementById('avatar-preview');

            input.addEventListener('change', function () {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        if (preview.tagName === 'IMG') {
                            preview.src = e.target.result;
                        } else {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = 'w-full h-full object-cover';
                            preview.replaceWith(img);
                            img.id = 'avatar-preview';
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
        </script>
    </div>

    <!-- First name -->
    <div class="relative">
        <label for="{{ form.first_name.id_for_label }}" class="block mb-2 text-sm font-medium text-gray-900">
            Есімі
        </label>
        <input 
            type="text"
            id="{{ form.first_name.id_for_label }}"
            name="first_name"
            value="{{ form.first_name.value }}"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"
            required 
        />
        {% for error in form.first_name.errors %}
            <p class="text-sm text-red-800">{{ error }}</p>
        {% endfor %}
    </div>

    <!-- Last name -->
    <div>
        <label for="{{ form.last_name.id_for_label }}" class="block mb-2 text-sm font-medium text-gray-900">
            Тегі
        </label>
        <input 
            type="text"
            id="{{ form.last_name.id_for_label }}"
            name="last_name"
            value="{{ form.last_name.value }}"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"
            required 
        />
        {% for error in form.last_name.errors %}
            <p class="text-sm text-red-800">{{ error }}</p>
        {% endfor %}
    </div>

    <button 
        type="submit" 
        class="cursor-pointer focus:outline-none text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300 font-medium rounded-lg px-5 py-2.5"
    >
        Сақтау
    </button>
</form>
{% endblock account_layout %}